name: Ping My Movie Sites
on:
  schedule:
    # æ¯50åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼ˆUTCæ—¶é—´ï¼‰
    - cron: '*/50 * * * *'
  # æ‰‹åŠ¨è§¦å‘æŒ‰é’®
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Zeabur/Cloudflare Pages Sites
        run: |
          ping_url() {
            local url=$1
            local name=$2
            # æ¨¡æ‹Ÿå®Œæ•´æµè§ˆå™¨è¯·æ±‚å¤´ï¼Œé€‚é…Cloudflareé˜²æŠ¤
            local status_code=$(curl -L \
              -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" \
              -H "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8" \
              -H "Accept-Language: zh-CN,zh;q=0.9,en;q=0.8" \
              -H "Accept-Encoding: gzip, deflate, br" \
              -H "Connection: keep-alive" \
              -H "Upgrade-Insecure-Requests: 1" \
              -s -o /dev/null -w "%{http_code}" "$url" \
              --connect-timeout 15 \
              --max-time 30)
            
            # åˆ¤æ–­çŠ¶æ€ç å¹¶æ·»åŠ ä¸­æ–‡æç¤º
            if [[ $status_code =~ ^2[0-9]{2}$ ]]; then
              # 2xxçŠ¶æ€ç  = è®¿é—®æˆåŠŸ
              echo "âœ… $name è®¿é—®çŠ¶æ€ç ï¼š$status_code - è®¿é—®æˆåŠŸ"
            elif [[ $status_code =~ ^3[0-9]{2}$ ]]; then
              # 3xxé‡å®šå‘ = è®¿é—®æˆåŠŸï¼ˆè·Ÿéšé‡å®šå‘åæœ‰æ•ˆï¼‰
              echo "ğŸ”„ $name è®¿é—®çŠ¶æ€ç ï¼š$status_code - é‡å®šå‘è®¿é—®æˆåŠŸ"
            else
              # å…¶ä»–çŠ¶æ€ç  = è®¿é—®å¤±è´¥
              echo "âŒ $name è®¿é—®çŠ¶æ€ç ï¼š$status_code - è®¿é—®å¤±è´¥"
            fi
          }

          # è°ƒç”¨å‡½æ•°ï¼Œæ›¿æ¢ä¸ºä½ çš„çœŸå®ç½‘å€
          ping_url "https://bad.zeabur.app" "Zeaburå½±è§†ç«™"
          ping_url "https://mozila.eu.org" "Cloudflare Pageså½±è§†ç«™"
        timeout-minutes: 5
        shell: /usr/bin/bash -e {0}
