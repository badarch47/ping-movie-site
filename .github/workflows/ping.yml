name: Ping My Movie Sites
on:
  schedule:
    # 每10分钟执行一次（UTC时间）
    - cron: '*/10 * * * *'
  # 手动触发按钮
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Zeabur/Cloudflare Pages Sites
        run: |
          # 定义函数：发送带浏览器头、跟随重定向的curl请求，并正确输出状态码
          ping_url() {
            local url=$1
            local name=$2
            # -L：跟随重定向；-A：模拟浏览器UA；-s：静默模式；-o：丢弃响应体；-w：输出状态码
            local status_code=$(curl -L -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" -s -o /dev/null -w "%{http_code}" "$url" --connect-timeout 10)
            echo "✅ $name 访问状态码：$status_code"
            # 若状态码不是2xx/3xx，标记为失败（可选，方便排查）
            if [[ ! $status_code =~ ^2[0-9]{2}$ && ! $status_code =~ ^3[0-9]{2}$ ]]; then
              echo "⚠️ $name 访问异常，状态码：$status_code"
            fi
          }

          # 调用函数，替换为你的真实网址
          ping_url "https://bad.zeabur.app" "Zeabur影视站"
          ping_url "https://mozila.eu.org" "Cloudflare Pages影视站"
        timeout-minutes: 5
        shell: /usr/bin/bash -e {0}
